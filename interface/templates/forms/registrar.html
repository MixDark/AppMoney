{% extends 'layout/base.html' %}
{% block title %}App Money{% endblock %}
{% block content %}
<style>
    /* Select styling */
    select {
        background-color: rgba(255, 255, 255, 0.4) !important;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e") !important;
        background-repeat: no-repeat !important;
        background-position: right 0.75rem center !important;
        background-size: 1.5em 1.5em !important;
        padding-right: 2.5rem !important;
        color: black !important;
        font-weight: 500 !important;
    }
    
    select option {
        background-color: rgba(255, 255, 255, 0.9);
        color: black;
        padding: 0.5rem;
    }
    
    select option:checked {
        background: linear-gradient(#0066ff, #0066ff);
        background-color: #0066ff !important;
        color: white !important;
    }
    
    /* Date input styling */
    input[type="date"] {
        background-color: rgba(255, 255, 255, 0.4) !important;
        color: black !important;
        font-weight: 500 !important;
        font-size: 1rem !important;
    }
    
    /* Calendar icon styling */
    input[type="date"]::-webkit-calendar-picker-indicator {
        cursor: pointer;
        border-radius: 4px;
        margin-right: 0.5rem;
        opacity: 0.9;
        filter: invert(0.3) brightness(0.9);
    }
    
    input[type="date"]::-webkit-outer-spin-button,
    input[type="date"]::-webkit-inner-spin-button {
        display: none;
    }
    
    /* Modal de confirmación */
    .confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 10000;
        justify-content: center;
        align-items: center;
    }
    
    .modal-content {
        background-color: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 1rem;
        padding: 2rem;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
</style>

<!-- Modal de confirmación (oculto inicialmente) -->
<div id="confirmationModal" class="confirmation-modal">
    <div class="modal-content">
        <h3 class="text-xl font-bold text-black mb-4 text-center">¿Confirmar eliminación?</h3>
        <p class="text-gray-700 mb-6 text-center">Esta acción no se puede deshacer. ¿Estás seguro de que quieres eliminar este registro?</p>
        <div class="flex justify-center gap-4">
            <button id="confirmCancel" class="px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg font-semibold transition-all">Cancelar</button>
            <button id="confirmDelete" class="px-6 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-semibold transition-all">Sí, eliminar</button>
        </div>
    </div>
</div>

<div class="max-w-lg w-full bg-white/20 backdrop-blur-xl p-16 rounded-3xl shadow-2xl border border-white/30 flex flex-col items-center">
    <h2 class="text-2xl font-bold mb-12 text-center text-black">Registrar ingreso o gasto</h2>
    <form method="post" class="space-y-8 w-full flex flex-col items-start">
        <div class="w-full flex flex-col items-start">
            <label class="block mb-3 text-black text-lg font-semibold">Tipo:</label>
            <select name="tipo" class="w-full appearance-none border border-white/30 rounded-2xl px-6 py-3 text-black text-base focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent backdrop-blur-sm transition-all duration-200 cursor-pointer">
                <option value="ingreso">Ingreso</option>
                <option value="gasto">Gasto</option>
                <option value="inversion">Inversión</option>
            </select>
        </div>
        <div class="w-full flex flex-col items-start">
            <label class="block mb-3 text-black text-lg font-semibold">Monto:</label>
            <input type="number" step="0.01" name="monto" required class="w-full bg-white/20 border border-white/30 rounded-2xl px-6 py-4 text-black text-base placeholder-black/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent backdrop-blur-sm transition-all duration-200">
        </div>
        <div class="w-full flex flex-col items-start">
            <label class="block mb-3 text-black text-lg font-semibold">Descripción:</label>
            <input type="text" name="descripcion" class="w-full bg-white/20 border border-white/30 rounded-2xl px-6 py-4 text-black text-base placeholder-black/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent backdrop-blur-sm transition-all duration-200">
        </div>
        <div class="w-full flex flex-col items-start">
            <label class="block mb-3 text-black text-lg font-semibold">Fecha:</label>
            <input type="date" name="fecha" required class="w-full border border-white/30 rounded-2xl px-6 py-4 text-black text-base focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent backdrop-blur-sm transition-all duration-200">
        </div>
        <button type="submit" class="mx-auto bg-white/40 backdrop-blur-xl text-black px-10 py-4 rounded-2xl text-2xl font-semibold border border-white/30 hover:bg-white/50 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">Registrar</button>
    </form>
</div>

<!-- Tabla de registros -->
<div class="w-full max-w-6xl mt-12">
    <!-- Contenedor principal para transacciones -->
    <div class="bg-white/50 backdrop-blur-sm rounded-xl overflow-hidden shadow-lg">
        <!-- Título dentro de la tarjeta -->
        <div class="px-6 py-4 border-b border-white/30 bg-black/5">
            <h3 class="text-2xl font-bold text-black text-center">Transacciones</h3>
        </div>
        
        <div class="p-4">
            <!-- Ingresos -->
            {% if ingresos %}
            <div class="mb-6">
                <h4 class="text-xl font-bold text-black mb-4">Ingresos</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="bg-black/10 border-b border-white/30">
                                <th class="text-left py-3 px-4 text-gray-900 font-semibold">Fecha</th>
                                <th class="text-left py-3 px-4 text-gray-900 font-semibold">Descripción</th>
                                <th class="text-right py-3 px-4 text-gray-900 font-semibold">Monto</th>
                                <th class="text-center py-3 px-4 text-gray-900 font-semibold">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ingreso in ingresos %}
                            <tr class="border-b border-white/30 hover:bg-white/30 transition-all">
                                <td class="py-3 px-4 text-gray-900 font-bold">{{ ingreso.fecha|format_date }}</td>
                                <td class="py-3 px-4 text-gray-900 font-bold">{{ ingreso.descripcion }}</td>
                                <td class="py-3 px-4 text-right text-green-700 font-bold">$ {{ ingreso.monto|format_money }}</td>
                                <td class="py-3 px-4 text-center">
                                    <a href="/editar_registro?id={{ ingreso.id }}&tipo=ingreso" class="bg-blue-500/70 hover:bg-blue-600/90 text-white px-3 py-1 rounded text-xs mr-2 transition-all inline-block font-bold">Editar</a>
                                    <button type="button" class="delete-btn bg-red-500/70 hover:bg-red-600/90 text-white px-3 py-1 rounded text-xs transition-all font-bold" 
                                            data-id="{{ ingreso.id }}" 
                                            data-tipo="ingreso"
                                            data-descripcion="{{ ingreso.descripcion }}"
                                            data-monto="$ {{ ingreso.monto|format_money }}">Eliminar</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            
            <!-- Gastos -->
            {% if gastos %}
            <div class="mb-6">
                <h4 class="text-xl font-bold text-black mb-4">Gastos</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="bg-black/10 border-b border-white/30">
                                <th class="text-left py-3 px-4 text-gray-900 font-semibold">Fecha</th>
                                <th class="text-left py-3 px-4 text-gray-900 font-semibold">Descripción</th>
                                <th class="text-right py-3 px-4 text-gray-900 font-semibold">Monto</th>
                                <th class="text-center py-3 px-4 text-gray-900 font-semibold">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for gasto in gastos %}
                            <tr class="border-b border-white/30 hover:bg-white/30 transition-all">
                                <td class="py-3 px-4 text-gray-900 font-bold">{{ gasto.fecha|format_date }}</td>
                                <td class="py-3 px-4 text-gray-900 font-bold">{{ gasto.descripcion }}</td>
                                <td class="py-3 px-4 text-right text-red-700 font-bold">$ {{ gasto.monto|format_money }}</td>
                                <td class="py-3 px-4 text-center">
                                    <a href="/editar_registro?id={{ gasto.id }}&tipo=gasto" class="bg-blue-500/70 hover:bg-blue-600/90 text-white px-3 py-1 rounded text-xs mr-2 transition-all inline-block font-bold">Editar</a>
                                    <button type="button" class="delete-btn bg-red-500/70 hover:bg-red-600/90 text-white px-3 py-1 rounded text-xs transition-all font-bold" 
                                            data-id="{{ gasto.id }}" 
                                            data-tipo="gasto"
                                            data-descripcion="{{ gasto.descripcion }}"
                                            data-monto="$ {{ gasto.monto|format_money }}">Eliminar</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
            
            <!-- Inversiones -->
            {% if inversiones %}
            <div>
                <h4 class="text-xl font-bold text-black mb-4">Inversiones</h4>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="bg-black/10 border-b border-white/30">
                                <th class="text-left py-3 px-4 text-gray-900 font-semibold">Fecha</th>
                                <th class="text-left py-3 px-4 text-gray-900 font-semibold">Descripción</th>
                                <th class="text-right py-3 px-4 text-gray-900 font-semibold">Monto</th>
                                <th class="text-center py-3 px-4 text-gray-900 font-semibold">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for inversion in inversiones %}
                            <tr class="border-b border-white/30 hover:bg-white/30 transition-all">
                                <td class="py-3 px-4 text-gray-900 font-bold">{{ inversion.fecha|format_date }}</td>
                                <td class="py-3 px-4 text-gray-900 font-bold">{{ inversion.descripcion }}</td>
                                <td class="py-3 px-4 text-right text-blue-700 font-bold">$ {{ inversion.monto|format_money }}</td>
                                <td class="py-3 px-4 text-center">
                                    <a href="/editar_registro?id={{ inversion.id }}&tipo=inversion" class="bg-blue-500/70 hover:bg-blue-600/90 text-white px-3 py-1 rounded text-xs mr-2 transition-all inline-block font-bold">Editar</a>
                                    <button type="button" class="delete-btn bg-red-500/70 hover:bg-red-600/90 text-white px-3 py-1 rounded text-xs transition-all font-bold" 
                                            data-id="{{ inversion.id }}" 
                                            data-tipo="inversion"
                                            data-descripcion="{{ inversion.descripcion }}"
                                            data-monto="$ {{ inversion.monto|format_money }}">Eliminar</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('confirmationModal');
        const confirmDeleteBtn = document.getElementById('confirmDelete');
        const confirmCancelBtn = document.getElementById('confirmCancel');
        let currentDeleteForm = null;
        let registroToDelete = null;

        // Configurar botones de eliminar
        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Guardar los datos del registro a eliminar
                registroToDelete = {
                    id: this.getAttribute('data-id'),
                    tipo: this.getAttribute('data-tipo'),
                    descripcion: this.getAttribute('data-descripcion'),
                    monto: this.getAttribute('data-monto')
                };
                
                // Mostrar modal de confirmación
                modal.style.display = 'flex';
            });
        });

        // Confirmar eliminación
        confirmDeleteBtn.addEventListener('click', function() {
            if (registroToDelete) {
                // Crear un formulario dinámico para enviar la solicitud de eliminación
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/eliminar_registro';
                
                const idInput = document.createElement('input');
                idInput.type = 'hidden';
                idInput.name = 'registro_id';
                idInput.value = registroToDelete.id;
                
                const tipoInput = document.createElement('input');
                tipoInput.type = 'hidden';
                tipoInput.name = 'tipo';
                tipoInput.value = registroToDelete.tipo;
                
                form.appendChild(idInput);
                form.appendChild(tipoInput);
                document.body.appendChild(form);
                form.submit();
            }
            
            // Ocultar modal
            modal.style.display = 'none';
        });

        // Cancelar eliminación
        confirmCancelBtn.addEventListener('click', function() {
            modal.style.display = 'none';
            registroToDelete = null;
        });

        // Cerrar modal haciendo clic fuera
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
                registroToDelete = null;
            }
        });
    });
</script>
{% endblock %}